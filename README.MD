# Gemini Backend Clone

A production-grade backend service that allows users to interact with Gemini (Google Generative AI) through authenticated chatrooms. It includes authentication, chat functionality, Stripe integration for Pro subscription, and BullMQ-based response queuing with Redis.

---

## ğŸ”§ Project Setup

### 1. Clone the repository

```bash
git clone https://github.com/<your-username>/gemini-backend-clone.git
cd gemini-backend-clone
```

### 2. Install dependencies

```bash
npm install
```

### 3. Environment Variables

Create a `.env` file in the root directory and configure:

```env
DATABASE_URL=your_postgresql_url
ACCESS_TOKEN_SECRET=your_jwt_secret
GEMINI_API_KEY=your_google_gemini_api_key
STRIPE_SECRET_KEY=your_stripe_secret_key
STRIPE_PRICE_ID=your_stripe_price_id
STRIPE_WEBHOOK_SECRET=your_stripe_webhook_secret
REDIS_URL=rediss://...
```

### 4. Run migrations and generate Prisma client

```bash
npx prisma migrate dev --name init
npx prisma generate
```

### 5. Start Redis (locally or use Upstash)

If using Upstash, make sure `REDIS_URL` is correct and secure.

### 6. Start the project

```bash
npm start
```

---

## ğŸ› Architecture Overview

- **Express.js** â€“ Main web framework
- **Prisma ORM** â€“ PostgreSQL ORM
- **Redis + BullMQ** â€“ For background message processing
- **Stripe** â€“ Subscription-based Pro upgrade
- **JWT Auth** â€“ Secured user sessions
- **Gemini API** â€“ AI-generated responses via Google Generative AI

---

## ğŸ“¦ Queue System (BullMQ + Redis)

1. User sends a message â†’ message is stored
2. Job is added to `gemini` queue
3. `geminiWorker.js` picks it up asynchronously
4. Worker calls Gemini API â†’ stores the response

### Benefits

- Scalable async processing
- Decoupled AI logic
- Easy monitoring via Redis

---

## ğŸ¤– Gemini API Integration

- Uses `@google/generative-ai` npm package
- Model used: `gemini-pro`
- Returns streaming or text-based response
- Free tier supports a limited number of requests

---

## ğŸ§  Design Decisions & Assumptions

- OTPs are mocked and sent in response (not SMS)
- Pro users are identified via Stripe + webhook + metadata
- Redis runs on Upstash (free-tier)
- Free tier: 5 messages allowed
- Stripe flow uses `checkout.session.completed` webhook to upgrade users

---

## ğŸ“¬ API Endpoints

### Auth Routes

| Method | Endpoint                | Auth | Description |
|--------|-------------------------|------|-------------|
| POST   | /auth/signup            | âŒ   | Signup with mobile number |
| POST   | /auth/send-otp          | âŒ   | Sends OTP to mobile |
| POST   | /auth/verify-otp        | âŒ   | Verifies OTP, returns JWT |
| POST   | /auth/forgot-password   | âŒ   | Sends OTP for password reset |
| POST   | /auth/change-password   | âœ…   | Changes password when logged in |
| GET    | /user/me                | âœ…   | Returns current user info |

### Chatroom Routes

| Method | Endpoint                  | Auth | Description |
|--------|---------------------------|------|-------------|
| POST   | /chatroom/                | âœ…   | Create a chatroom |
| GET    | /chatroom/                | âœ…   | Get all chatrooms (cached) |
| GET    | /chatroom/:id             | âœ…   | Get specific chatroom details |
| POST   | /chatroom/:id/message     | âœ…   | Send a message to Gemini |

### Subscription (Stripe) Routes

| Method | Endpoint                  | Auth | Description |
|--------|---------------------------|------|-------------|
| POST   | /subscribe/pro            | âœ…   | Starts Stripe checkout |
| POST   | /webhook/stripe           | â›”   | Stripe calls this on payment success |
| GET    | /subscription/status      | âœ…   | Get current subscription tier |

---

## ğŸ“® Testing via Postman

1. Import the exported Postman collection (`Gemini Backend.postman_collection.json`)
2. Set the `{{baseUrl}}` variable to `https://gemini-backend-clone.onrender.com/`
3. Test endpoints in this order:
   - `POST /auth/signup`
   - `POST /auth/send-otp`
   - `POST /auth/verify-otp` â†’ Save JWT token
   - Set `Authorization: Bearer <token>` for protected routes
   - `POST /subscribe/pro` â†’ Complete Stripe payment
   - Test `GET /subscription/status` and chatroom APIs

---

## ğŸŒ Deployment

### Backend Hosted On:
ğŸ‘‰ [`https://gemini-backend-clone.onrender.com/`](https://gemini-backend-clone.onrender.com/)

### PostgreSQL:
ğŸ‘‰ Hosted on Railway

### Redis:
ğŸ‘‰ Hosted on Upstash

---

## ğŸ‘¨â€ğŸ’» Author

Built by [Harshil Vasani](https://github.com/harshilvasani)